<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T16U3">b</span>] = Calc_CrossCorr_8(<span class="var type1" id="S3T1U6">D1</span>,<span class="var type1" id="S4T1U7">D2</span>,<span class="var type1" id="S5T2U8">i1</span>,<span class="var type1" id="S6T2U9">i2</span>,<span class="var type1" id="S7T3U10">p</span>,<span class="var type1" id="S8T1U11">Mask</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3"> 3</a></span><span class="line"><span class="comment">%p = length(i1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4"> 4</a></span><span class="line"><span class="comment">%b = zeros(p-1,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5"> 5</a></span><span class="line"><span class="mxinfo" id="T14:U8"><span class="var type1" id="S2T14U14">b</span> = <span class="mxinfo" id="T14:U10">zeros(64,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7"> 7</a></span><span class="line"><span class="comment">%I1 = size(D1,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8"> 8</a></span><span class="line"><span class="comment">%I2 = size(D2,2);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9"> 9</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,10">10</a></span><span class="line"><span class="comment">%mask = zeros(I1*I2,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11">11</a></span><span class="line"><span class="comment">%mask(sub2ind([I1,I2], ind1(1:K)', ind2(1:K)'))=1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12">12</a></span><span class="line"><span class="comment">%w = kron(D2(:,i2(p)),D1(:,i1(p))).*mask;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13">13</a></span><span class="line"><span class="mxinfo" id="T1:U11"><span class="var type1" id="S10T1U21">W</span> = <span class="mxinfo" id="T1:U13">(<span class="mxinfo" id="T1:U14"><span class="mxinfo" id="T4:U15"><span class="var type1" id="S3T1U26">D1</span>(<span class="mxinfo" id="T17:U17">:</span>,<span class="mxinfo" id="T3:U18"><span class="var type1" id="S5T2U29">i1</span>(<span class="var type1" id="S7T3U30">p</span>)</span>)</span>*<span class="mxinfo" id="T5:U21"><span class="mxinfo" id="T4:U22"><span class="var type1" id="S4T1U33">D2</span>(<span class="mxinfo" id="T17:U24">:</span>,<span class="mxinfo" id="T3:U25"><span class="var type1" id="S6T2U36">i2</span>(<span class="var type1" id="S7T3U37">p</span>)</span>)</span>'</span></span>).*<span class="var type1" id="S8T1U38">Mask</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14">14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15">15</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S11T3U41">p1</span>=<span class="mxinfo" id="T3:U30">1</span>:<span class="mxinfo" id="T3:U31"><span class="var type1" id="S7T3U45">p</span>-<span class="mxinfo" id="T3:U33">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16">16</a></span><span class="line">   <span class="comment">%b(p1) = kron(D2(:,i2(p1))',D1(:,i1(p1))')*w;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17">17</a></span><span class="line">   <span class="mxinfo" id="T3:U34"><span class="mxinfo" id="T3:U35"><span class="var type1" id="S2T14U50">b</span>(<span class="var type1" id="S11T3U51">p1</span>)</span> = <span class="mxinfo" id="T3:U38"><span class="mxinfo" id="T5:U39"><span class="mxinfo" id="T5:U40"><span class="mxinfo" id="T4:U41"><span class="var type1" id="S3T1U56">D1</span>(<span class="mxinfo" id="T17:U43">:</span>,<span class="mxinfo" id="T3:U44"><span class="var type1" id="S5T2U59">i1</span>(<span class="var type1" id="S11T3U60">p1</span>)</span>)</span>'</span>*<span class="var type1" id="S10T1U61">W</span></span>*<span class="mxinfo" id="T4:U48"><span class="var type1" id="S4T1U63">D2</span>(<span class="mxinfo" id="T17:U50">:</span>,<span class="mxinfo" id="T3:U51"><span class="var type1" id="S6T2U66">i2</span>(<span class="var type1" id="S11T3U67">p1</span>)</span>)</span></span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="1,18">18</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19">19</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,20">20</a></span><span class="line"><span class="mxinfo" id="T16:U54"><span class="var type1" id="S2T16U70">b</span> = <span class="mxinfo" id="T16:U56"><span class="var type1" id="S2T14U72">b</span>(<span class="mxinfo" id="T18:U58"><span class="mxinfo" id="T3:U59">1</span>:<span class="mxinfo" id="T3:U60"><span class="var type1" id="S7T3U76">p</span>-<span class="mxinfo" id="T3:U62">1</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21">21</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,22">22</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
