<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T9U3">cii</span>] = Calc_cii3D_8(<span class="var type1" id="S3T1U6">D1</span>,<span class="var type1" id="S4T1U7">D2</span>,<span class="var type1" id="S5T1U8">D3</span>,<span class="var type1" id="S6T8U9">Mask</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2"> 2</a></span><span class="line"><span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3"> 3</a></span><span class="line"><span class="mxinfo" id="T2:U6"><span class="var type1" id="S7T2U12">I1</span> = <span class="mxinfo" id="T2:U8">size(<span class="var type1" id="S3T1U15">D1</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4"> 4</a></span><span class="line"><span class="mxinfo" id="T2:U10"><span class="var type1" id="S9T2U19">I2</span> = <span class="mxinfo" id="T2:U12">size(<span class="var type1" id="S4T1U22">D2</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5"> 5</a></span><span class="line"><span class="mxinfo" id="T2:U14"><span class="var type1" id="S10T2U26">I3</span> = <span class="mxinfo" id="T2:U16">size(<span class="var type1" id="S5T1U29">D3</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6"> 6</a></span><span class="line"><span class="comment">%cii = zeros(I1*I2*I3,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7"> 7</a></span><span class="line"><span class="mxinfo" id="T8:U18"><span class="var type1" id="S2T8U33">cii</span> = <span class="mxinfo" id="T8:U20">zeros(<span class="var type1" id="S7T2U36">I1</span>,<span class="var type1" id="S9T2U37">I2</span>,<span class="var type1" id="S10T2U38">I3</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8"> 8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9"> 9</a></span><span class="line"><span class="comment">%mask = zeros(I1*I2,1);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10">10</a></span><span class="line"><span class="comment">%mask(sub2ind([I1,I2], ind1(1:K)', ind2(1:K)'))=1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11">11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12">12</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S12T2U41">j3</span>=<span class="mxinfo" id="T2:U25">1</span>:<span class="mxinfo" id="T2:U26"><span class="var type1" id="S10T2U44">I3</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13">13</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S13T2U47">j2</span>=<span class="mxinfo" id="T2:U29">1</span>:<span class="mxinfo" id="T2:U30"><span class="var type1" id="S9T2U50">I2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14">14</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S14T2U53">j1</span>=<span class="mxinfo" id="T2:U33">1</span>:<span class="mxinfo" id="T2:U34"><span class="var type1" id="S7T2U56">I1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15">15</a></span><span class="line">            <span class="comment">%w = kron(D2(:,j2),D1(:,j1)).*mask;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16">16</a></span><span class="line">            <span class="comment">%W = (D1(:,j1)*D2(:,j2)').*Mask;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17">17</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,18">18</a></span><span class="line">            <span class="mxinfo" id="T1:U36"><span class="var type1" id="S15T1U59">w</span> = <span class="mxinfo" id="T1:U38"><span class="mxinfo" id="T3:U39"><span class="var type1" id="S3T1U62">D1</span>(<span class="mxinfo" id="T21:U41">:</span>,<span class="var type1" id="S14T2U64">j1</span>)</span>*<span class="mxinfo" id="T4:U43"><span class="mxinfo" id="T3:U44"><span class="var type1" id="S4T1U67">D2</span>(<span class="mxinfo" id="T21:U46">:</span>,<span class="var type1" id="S13T2U69">j2</span>)</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,19">19</a></span><span class="line">            <span class="mxinfo" id="T7:U48"><span class="var type1" id="S15T7U72">w</span> = <span class="mxinfo" id="T7:U50"><span class="mxinfo" id="T6:U51"><span class="var type1" id="S15T1U75">w</span>(:)</span>*<span class="mxinfo" id="T4:U53"><span class="mxinfo" id="T3:U54"><span class="var type1" id="S5T1U79">D3</span>(<span class="mxinfo" id="T21:U56">:</span>,<span class="var type1" id="S12T2U81">j3</span>)</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20">20</a></span><span class="line">            <span class="mxinfo" id="T9:U58"><span class="var type1" id="S15T9U84">w</span> = <span class="mxinfo" id="T9:U60"><span class="mxinfo" id="T9:U61"><span class="var type1" id="S15T7U87">w</span>(:)</span>.*<span class="mxinfo" id="T9:U63"><span class="var type1" id="S6T8U90">Mask</span>(:)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,21">21</a></span><span class="line">            <span class="comment">%cii(sub2ind([I1,I2,I3], j1, j2, j3)) = sqrt(sum(w(:).^2));</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22">22</a></span><span class="line">            <span class="mxinfo" id="T2:U65"><span class="mxinfo" id="T2:U66"><span class="var type1" id="S2T8U95">cii</span>(<span class="var type1" id="S14T2U96">j1</span>, <span class="var type1" id="S13T2U97">j2</span>, <span class="var type1" id="S12T2U98">j3</span>)</span> = <span class="mxinfo" id="T2:U71">sqrt(<span class="mxinfo" id="T2:U72">sum(<span class="mxinfo" id="T9:U73"><span class="mxinfo" id="T9:U74"><span class="var type1" id="S15T9U105">w</span>(:)</span>.^<span class="mxinfo" id="T2:U76">2</span></span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23">23</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24">24</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25">25</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26">26</a></span><span class="line"><span class="mxinfo" id="T9:U77"><span class="var type1" id="S2T9U110">cii</span> = <span class="mxinfo" id="T9:U79">reshape(<span class="var type1" id="S2T8U113">cii</span>,[<span class="var type1" id="S7T2U118">I1</span>*<span class="var type1" id="S9T2U119">I2</span>*<span class="var type1" id="S10T2U120">I3</span>,1])</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27">27</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,28">28</a></span><span class="line"><span class="keyword">end</span></span></span>
</pre>
